<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="jsonplaceholderservices-test-suite.xml" />
	<munit:test name="testGetAllPostsWithComments">
    <munit:execution>
			<flow-ref doc:name="Flow Reference" doc:id="0c4a646f-2c0a-48da-a2bd-aed7d1ed67f0" name="getAllPostsWithCommentsFlow"/>
    </munit:execution>
    <munit:behavior>
        <munit-tools:mock-when processor="http:request">
            <munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="HTTP_Request_configuration" attributeName="config-ref" />
					<munit-tools:with-attribute whereValue="GET" attributeName="method" />
					<munit-tools:with-attribute whereValue="https://jsonplaceholder.typicode.com/posts" attributeName="url" />
					<munit-tools:with-attribute whereValue="Get Posts" attributeName="doc:name" />
				</munit-tools:with-attributes>
				<munit-tools:then-return payload="[{id:1, title:'Post 1'}]" statusCode="200"/>
        </munit-tools:mock-when>
        <munit-tools:mock-when processor="http:request">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="HTTP_Request_configuration" attributeName="config-ref" />
					<munit-tools:with-attribute whereValue="GET" attributeName="method" />
					<munit-tools:with-attribute whereValue="https://jsonplaceholder.typicode.com/comments" attributeName="url" />
					<munit-tools:with-attribute whereValue="Get Comments" attributeName="doc:name" />
				</munit-tools:with-attributes>
				<munit-tools:then-return payload="[{id:1, title:'Post 1'}]" statusCode="200"/>
        </munit-tools:mock-when>
    </munit:behavior>
    <munit:validation>
        <munit-tools:assert-payload-equals expectedValue="[{id:1,title:'Post 1',comments:[]}]" doc:name="Assert Response"/>
    </munit:validation>
</munit:test>
<munit:test name="testRemovePost">
    <munit:execution>
			<flow-ref doc:name="Flow Reference" doc:id="5f364b85-652e-4748-af02-76ce617d0486" name="removePostFlow"/>
    </munit:execution>
    <munit:behavior>
        <munit-tools:mock-when processor="http:request">
            <munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="HTTP_Request_configuration" attributeName="config-ref" />
					<munit-tools:with-attribute whereValue="DELETE" attributeName="method" />
					<munit-tools:with-attribute whereValue="https://jsonplaceholder.typicode.com/comments" attributeName="url" />
					<munit-tools:with-attribute whereValue="Delete Comments" attributeName="doc:name" />
				</munit-tools:with-attributes>
				<munit-tools:then-return statusCode="200"/>
        </munit-tools:mock-when>
    </munit:behavior>
    <munit:validation>
        <munit-tools:assert-payload-equals expectedValue="{message:'Post and comments deleted successfully.'}" doc:name="Assert Response"/>
    </munit:validation>
</munit:test>
	<munit:test name="testupdateCommentFlow" doc:id="0e6ee5eb-7b5b-4c6f-9f6b-1a342d4ee046" description="Test">
		<munit:execution >
			<flow-ref doc:name="Flow-ref to updateCommentFlow" doc:id="a62fdb6e-e0a6-4e2d-abdf-7e2a85187082" name="updateCommentFlow"/>
		</munit:execution>
		<munit:behavior>
        <munit-tools:mock-when processor="http:request" doc:name="Mock Update Comment">
            <munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Update Comment" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="b5e847f3-be5b-4f48-9bad-bf57eac460fc" attributeName="doc:id" />
					<munit-tools:with-attribute whereValue="PUT" attributeName="method" />
					<munit-tools:with-attribute whereValue="https://jsonplaceholder.typicode.com/comments/{commentId}" attributeName="url" />
				</munit-tools:with-attributes>
				
        </munit-tools:mock-when>
    </munit:behavior>
    <munit:validation>
        <munit-tools:assert-payload-equals expectedValue="{message:Comment updated successfully.}" doc:name="Validate Response"/>
    </munit:validation>
	</munit:test>
</mule>
